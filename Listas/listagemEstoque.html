<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- ===== CSS ===== -->
        <link rel="stylesheet" href="../assets/css/styles.css">
        <link rel="icon" type="image/x-icon" href="assets/img/file.ico">
        
        <title>Cadastro de Estoque</title>
    </head>
    <body class="body-telas" id="body-pd">
        <div class="l-navbar" id="navbar">
            <nav class="nav">
                <div>
                    <div class="nav__brand">
                        <ion-icon name="menu-outline" class="nav__toggle" id="nav-toggle"></ion-icon>
                        <a href="index.html" class="nav__logo">Comercialize</a>
                    </div>
                    <div class="nav__list">
                        <a href="index.html" class="nav__link active">
                            <ion-icon name="home-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Dashboard</span>
                        </a>
                        <a href="#" class="nav__link">
                            <ion-icon name="chatbubbles-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Messenger</span>
                        </a>

                        <div  class="nav__link collapse collapse__link">
                            <ion-icon name="folder-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Cadastros</span>

                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>

                            <ul class="collapse__menu">
                                <a href="cadastrarCliente.html" class="collapse__sublink">Cliente</a>
                                <a href="cadastrarProduto.html" class="collapse__sublink">Produto</a>
                                <a href="cadastrarUsuario.html" class="collapse__sublink">Usuário</a>
                                <a href="cadastrarEstoque.html" class="collapse__sublink">Estoque</a>
                            </ul>
                        </div>

                        <div  class="nav__link collapse">
                            <ion-icon name="folder-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Cadastros</span>

                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>

                            <ul class="collapse__menu">
                                <a href="../Cadastros/cadastrarCliente.html" class="collapse__sublink">Cliente</a>
                                <a href="../Cadastros/cadastrarProduto.html" class="collapse__sublink">Produto</a>
                                <a href="../Cadastros/cadastrarUsuario.html" class="collapse__sublink">Usuário</a>
                                <a href="../Cadastros/cadastrarEstoque.html" class="collapse__sublink">Estoque</a>
                            </ul>
                        </div>

                        <a href="#" class="nav__link">
                            <ion-icon name="pie-chart-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Analytics</span>
                        </a>
                        <div class="nav__link collapse">
                            <ion-icon name="people-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Team</span>

                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>

                            <ul class="collapse__menu">
                                <a href="#" class="collapse__sublink">Data</a>
                                <a href="#" class="collapse__sublink">Group</a>
                                <a href="#" class="collapse__sublink">Members</a>
                            </ul>
                        </div>
                        <a href="#" class="nav__link">
                            <ion-icon name="settings-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Configurações</span>
                        </a>
                    </div>
                </div>

                <a href="login.html" class="nav__link">
                    <ion-icon name="log-out-outline" class="nav__icon"></ion-icon>
                    <span class="nav__name">Sair</span>
                </a>
            </nav>
        </div>

        <h1>Cadastro de Estoque</h1>

        <div class="container">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Nome</th>
                        <th scope="col">Login</th>
                        <th scope="col">Administrador</th>
                        <th scope="col">Ações</th>
                    </tr>
                </thead>
                <tbody id="usuarios-container">
                    <!-- Os dados dos usuários serão inseridos aqui -->
                </tbody>
            </table>
        </div>

        <!-- Modal de Edição de Usuário -->
        <div id="editarUsuarioModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeModal">&times;</span>
                <h2>Editar Usuário</h2>
                <form id="editarUsuarioForm" class="form-modal">
                    <div class="form-group">
                        <label for="nomeUsuario">Nome:</label>
                        <input type="text" id="nomeUsuario" name="nomeUsuario" required>   
                        <label for="loginUsuario">Login:</label>
                        <input type="text" id="loginUsuario" name="loginUsuario" required>
                    <div class="form-group form-actions">
                        <label for="ehAdmUsuario">Administrador:</label>
                        <input type="checkbox" id="ehAdmUsuario" name="ehAdmUsuario">
                    </div>
                    <div class="form-group">
                        <button type="button" id="salvarEdicao" class="btn">Salvar</button>
                    </div>
                </form>
                <style>
                    .form-modal {
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                    }

                    .form-group {
                        display: flex;
                        flex-direction: column;
                    }

                    .form-group label {
                        margin-bottom: 5px;
                        font-weight: bold;
                    }

                    .form-group input[type="text"] {
                        padding: 10px;
                        border: 1px solid #ccc;
                        border-radius: 5px;
                    }

                    .form-group input[type="checkbox"] {
                        width: auto;
                    }

                    .btn {
                        padding: 10px 20px;
                        background-color: #4CAF50;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        align-self: flex-start;
                    }

                    .btn:hover {
                        background-color: #45a049;
                    }

                    .form-actions {
                        display: flex;
                        align-items: center; /* Alinha verticalmente os itens */
                        gap: 10px; /* Espaçamento entre o texto e o checkbox */
                        flex-direction: row;
                        margin: 10px 0;
                    }

                    .form-actions label {
                        margin: 0; /* Remove margens extras no rótulo */
                    }

                    .modal {
                        display: none;
                        position: fixed;
                        z-index: 1;
                        left: 0;
                        top: 0;
                        width: 100%;
                        height: 100%;
                        overflow: auto;
                        background-color: rgb(0,0,0);
                        background-color: rgba(0,0,0,0.4);
                    }

                    .modal-content {
                        background-color: #fefefe;
                        margin: 15% auto;
                        padding: 20px;
                        border: 1px solid #888;
                        width: 80%;
                    }

                    .close {
                        color: #aaa;
                        float: right;
                        font-size: 28px;
                        font-weight: bold;
                    }

                    .close:hover,
                    .close:focus {
                        color: black;
                        text-decoration: none;
                        cursor: pointer;
                    }
                </style>
            </div>
        </div>

        <style>
        
        </style>

        <!-- ===== IONICONS ===== -->
        <script src="https://unpkg.com/ionicons@5.1.2/dist/ionicons.js"></script>
        
        <!-- ===== MAIN JS ===== -->
        <script src="../assets/js/main.js"></script>
        <script>
        async function fetchUsuarios() {
        try {
        const response = await fetch('https://vendas-comercialize-a0fqhjhne5cagkc5.brazilsouth-01.azurewebsites.net/Usuario/buscar-todos-usuarios');

        // Verifica se a resposta está ok (status 200-299)
        if (!response.ok) {
            const errorMessage = await response.text(); // Captura a mensagem de erro do servidor
            throw new Error(`Network response was not ok: ${response.status} - ${errorMessage}`);
        }

        const usuarios = await response.json();
        const tbody = document.querySelector('#usuarios-container');

        // Limpa o tbody antes de adicionar novos usuários
        tbody.innerHTML = '';

        // Verifica se a resposta contém usuários
        if (Array.isArray(usuarios)) {
            usuarios.forEach(usuario => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <th scope="row">${usuario.idUsuario}</th>
                    <td>${usuario.nomeUsuario}</td>
                    <td>${usuario.login}</td>
                    <td>${usuario.ehAdm == 1 ? 'Sim' : 'Não'}</td>
                     <td>
                        <ion-icon name="create-outline" class="button-edit" data-id="${usuario.idUsuario}" onclick="editarUsuario(this)">Editar</ion-icon> 
                        <ion-icon name="trash" class="button-delete" onclick="apagarUsuario(${usuario.id})">Apagar</ion-icon>
                    </td>
                `;
                tbody.appendChild(row);
            });
        } else {
            console.error('A resposta não é um array:', usuarios);
        }
    } catch (error) {
        console.error('There has been a problem with your fetch operation:', error);
    }
}

        document.addEventListener('DOMContentLoaded', fetchUsuarios);

        document.getElementById('closeModal').onclick = function() {
        document.getElementById('editarUsuarioModal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById('editarUsuarioModal')) {
                document.getElementById('editarUsuarioModal').style.display = 'none';
            }
        }
        </script>
        <script src="../assets/js/requisicoes/cadastrarEstoque.js"></script>
    </body>
</html>
