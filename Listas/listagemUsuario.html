<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- ===== CSS ===== -->
        <link rel="stylesheet" href="../assets/css/styles.css">
        <link rel="stylesheet" href="../assets/css/modal.css">
        <link rel="icon" type="image/x-icon" href="assets/img/file.ico">
        
        <title>Lista de Usuário</title>
    </head>
    <body class="body-telas" id="body-pd">
        <div class="l-navbar" id="navbar">
            <nav class="nav">
                <div>
                    <div class="nav__brand">
                        <ion-icon name="menu-outline" class="nav__toggle" id="nav-toggle"></ion-icon>
                        <a href="../login.html" class="nav__logo">Comercialize</a>
                    </div>
                    <div class="nav__list">
                        <a href="../login.html" class="nav__link active">
                            <ion-icon name="home-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Dashboard</span>
                        </a>
                        <a href="#" class="nav__link">
                            <ion-icon name="chatbubbles-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Messenger</span>
                        </a>

                        <div class="nav__link collapse collapse__link">
                            <ion-icon name="folder-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Cadastros</span>

                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>

                            <ul class="collapse__menu">
                                <a href="../Cadastros/cadastrarCliente.html" class="collapse__sublink">Cliente</a>
                                <a href="../Cadastros/cadastrarEstoque.html" class="collapse__sublink">Estoque</a>
                                <a href="../Cadastros/cadastrarEstoqueProduto.html" class="collapse__sublink">Estoque/Produto</a>
                                <a href="../Cadastros/cadastrarProduto.html" class="collapse__sublink">Produto</a>
                                <a href="../Cadastros/cadastrarUsuario.html" class="collapse__sublink">Usuário</a>
                                <a href="../Cadastros/cadastrarVendas.html" class="collapse__sublink">Vendas</a>
                                
                            </ul>
                        </div>

                        <div  class="nav__link collapse collapse__link">
                            <ion-icon name="folder-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Listagens</span>

                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>

                            <ul class="collapse__menu">
                                <a href="../Listas/listagemCliente" class="collapse__sublink">Cliente</a>
                                <a href="../Listas/listagemEstoque" class="collapse__sublink">Estoque</a>
                                <a href="../Listas/listagemEstoqueProduto.html" class="collapse__sublink">Estoque/Produto</a>
                                <a href="../Listas/listagemProduto" class="collapse__sublink">Produto</a>
                                <a href="../Listas/listagemUsuario" class="collapse__sublink">Usuário</a>
                                <a href="../Listas/listagemVendas.html" class="collapse__sublink">Vendas</a>
                            </ul>
                        </div>

                        <a href="#" class="nav__link">
                            <ion-icon name="pie-chart-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Analytics</span>
                        </a>
                        <div class="nav__link collapse">
                            <ion-icon name="people-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Team</span>

                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>

                            <ul class="collapse__menu">
                                <a href="#" class="collapse__sublink">Data</a>
                                <a href="#" class="collapse__sublink">Group</a>
                                <a href="#" class="collapse__sublink">Members</a>
                            </ul>
                        </div>
                        <a href="#" class="nav__link">
                            <ion-icon name="settings-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Configurações</span>
                        </a>
                    </div>
                </div>

                <a href="../login.html" class="nav__link" onclick="sessaoExpirada()">
                    <ion-icon name="log-out-outline" class="nav__icon"></ion-icon>
                    <span class="nav__name">Sair</span>
                </a>
            </nav>
        </div>

        <h1>Lista de Usuário</h1>

        <div class="containerLista">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Nome</th>
                        <th scope="col">Login</th>
                        <th scope="col">Administrador</th>
                        <th scope="col">Ações</th>
                    </tr>
                </thead>
                <tbody id="usuarios-container">
                    <!-- Os dados dos usuários serão inseridos aqui -->
                </tbody>
            </table>
        </div>

        <!-- Modal de Edição de Usuário -->
        <div id="editarUsuarioModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeModal">&times;</span>
                <h2>Editar Usuário</h2>
                <form id="editarUsuarioForm" class="form-modal">
                    <div class="form-group">
                        <label for="nomeUsuario">Nome:</label>
                        <input type="text" id="nomeUsuario" name="nomeUsuario" required>   
                        <label for="loginUsuario">Login:</label>
                        <input type="text" id="loginUsuario" name="loginUsuario" required>
                    <div class="form-group form-actions">
                        <label for="ehAdmUsuario">Administrador:</label>
                        <input type="checkbox" id="ehAdmUsuario" name="ehAdmUsuario">
                    </div>
                    <div class="form-group">
                        <button type="button" id="salvarEdicao" class="btn">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <style>
        
        </style>

        <!-- ===== IONICONS ===== -->
        <script src="https://unpkg.com/ionicons@5.1.2/dist/ionicons.js"></script>
        
        <!-- ===== MAIN JS ===== -->
        <script src="../assets/js/main.js"></script>
        <script>
        async function fetchUsuarios() {
        try {
        const response = await fetch('https://vendas-comercialize-a0fqhjhne5cagkc5.brazilsouth-01.azurewebsites.net/Usuario/buscar-todos-usuarios');

        // Verifica se a resposta está ok (status 200-299)
        if (!response.ok) {
            const errorMessage = await response.text(); // Captura a mensagem de erro do servidor
            throw new Error(`Network response was not ok: ${response.status} - ${errorMessage}`);
        }

        const usuarios = await response.json();
        const tbody = document.querySelector('#usuarios-container');

        // Limpa o tbody antes de adicionar novos usuários
        tbody.innerHTML = '';

        // Verifica se a resposta contém usuários
        if (Array.isArray(usuarios)) {
            usuarios.forEach(usuario => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <th scope="row">${usuario.idUsuario}</th>
                    <td>${usuario.nomeUsuario}</td>
                    <td>${usuario.login}</td>
                    <td>${usuario.ehAdm == 1 ? 'Sim' : 'Não'}</td>
                     <td>
                        <ion-icon name="create-outline" class="button-edit" data-id="${usuario.idUsuario}" onclick="editarUsuario(this)">Editar</ion-icon> 
                        <ion-icon name="trash" class="button-delete" data-id="${usuario.idUsuario}" onclick="excluirUsuario(this)">Apagar</ion-icon>
                    </td>
                `;
                tbody.appendChild(row);
            });
        } else {
            console.error('A resposta não é um array:', usuarios);
        }
    } catch (error) {
        console.error('There has been a problem with your fetch operation:', error);
    }
}

        document.addEventListener('DOMContentLoaded', fetchUsuarios);

        document.getElementById('closeModal').onclick = function() {
        document.getElementById('editarUsuarioModal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById('editarUsuarioModal')) {
                document.getElementById('editarUsuarioModal').style.display = 'none';
            }
        }
        </script>
        <script src="../assets/js/requisicoes/cadastrarUsuario.js"></script>
    </body>
</html>
