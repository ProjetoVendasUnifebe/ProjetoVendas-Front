<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <!-- ===== CSS ===== -->
        <link rel="stylesheet" href="../assets/css/styles.css">
        <link rel="stylesheet" href="../assets/css/ListaProduto.css">
        <link rel="icon" type="image/x-icon" href="../assets/img/file.ico">
        <script src="/assets/js/ApenasSessao.js"></script>
        
        <title>Cadastro de Produtos</title>
    </head>
    <body class="body-telas" id="body-pd">
        <div class="l-navbar" id="navbar">
            <nav class="nav">
                <div>
                    <div class="nav__brand">
                        <ion-icon name="menu-outline" class="nav__toggle" id="nav-toggle"></ion-icon>
                        <a href="../index.html" class="nav__logo">Comercialize</a>
                    </div>
                    <div class="nav__list">
                        <a href="../index.html" class="nav__link active">
                            <ion-icon name="home-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Dashboard</span>
                        </a>
                        <div class="nav__link collapse collapse__link">
                            <ion-icon name="folder-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Cadastros</span>
                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>
                            <ul class="collapse__menu">
                                <a href="../Cadastros/cadastrarCliente.html" class="collapse__sublink">Cliente</a>
                                <a href="../Cadastros/cadastrarProduto.html" class="collapse__sublink">Produto</a>
                                <a href="../Cadastros/cadastrarUsuario.html" class="collapse__sublink">Usuário</a>
                                <a href="../Cadastros/cadastrarEstoque.html" class="collapse__sublink">Estoque</a>
                                <a href="../Cadastros/cadastrarEstoqueProduto.html" class="collapse__sublink">Estoque Produto</a>
                                <a href="../Cadastros/cadastrarVendas.html" class="collapse__sublink">Vendas</a>
                                <a href="../Cadastros/cadastrarItensVendidos.html" class="collapse__sublink">Itens por venda</a>
                            </ul>
    
                        </div>
                        <div class="nav__link collapse collapse__link">
                            <ion-icon name="folder-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Listagens</span>
                            <ion-icon name="chevron-down-outline" class="collapse__link"></ion-icon>
                            <ul class="collapse__menu">
                                <a href="../Listas/listagemCliente.html" class="collapse__sublink">Cliente</a>
                                <a href="../Listas/listagemProduto.html" class="collapse__sublink">Produto</a>
                                <a href="../Listas/listagemUsuario.html" class="collapse__sublink">Usuário</a>
                                <a href="../Listas/listagemEstoque.html" class="collapse__sublink">Estoque</a>
                                <a href="../Listas/listagemEstoqueProduto.html" class="collapse__sublink">Estoque Produto</a>
                                <a href="../Listas/listagemVendas.html" class="collapse__sublink">Vendas</a>
                                <a href="../Listas/listagemItensVendidos.html" class="collapse__sublink">Itens por venda</a>
                            </ul>
                        </div>
                        <a href="../relatorios.html" class="nav__link">
                            <ion-icon name="pie-chart-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Relatórios</span>
                        </a>
                        <a href="#" class="nav__link">
                            <ion-icon name="settings-outline" class="nav__icon"></ion-icon>
                            <span class="nav__name">Configurações</span>
                        </a>
                    </div>
                </div>
                <a href="../login.html" class="nav__link">
                    <ion-icon name="log-out-outline" class="nav__icon"></ion-icon>
                    <span class="nav__name">Sair</span>
                </a>
            </nav>
        </div>

        <h1>Cadastro de Produto</h1>

        <div class="container">
            <h1 class="subtitulo">Produto</h1>
            <form class="cadastro-form" method="post" id="formP" onsubmit="event.preventDefault(); cadastrarProduto(); ">
                <div class="forme">
                    <label for="nomeProduto">Produto:</label>
                    <input type="text" id="nomeProduto" name="nomeProduto" placeholder="Produto" required>
                    <label for="qtdProduto">Valor:</label>
                    <input type="number" id="qtdProduto" name="qtdProduto" placeholder="Valor" required>
                </div>
                <div class="formd">
                    <label for="descricaoProduto">Descrição:</label>
                    <textarea name="descricaoProduto" id="descricaoProduto" placeholder="Descrição" required></textarea>
                </div>
                <div class="Botões">
                    <button type="submit" class="Btnexc">Cadastrar</button>
                    <button type="reset" class="Btnexc">Descartar</button>
                </div>
            </form>
        </div>

        <!-- ===== IONICONS ===== -->
        <script src="https://unpkg.com/ionicons@5.1.2/dist/ionicons.js"></script>
        
        <!-- ===== MAIN JS ===== -->
        <script src="../assets/js/main.js"></script>
        <script src="../assets/js/scripts.js"></script>

        <!-- Toastify CSS -->
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

        <!-- Toastify JS -->
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    </body>

    <script>

        function cadastrarProduto() {
            const url = 'https://vendas-comercialize-a0fqhjhne5cagkc5.brazilsouth-01.azurewebsites.net/Produto/adicionar-produto';
            
            // Captura os valores dos campos do formulário
            const nomeProduto = document.getElementById("nomeProduto").value;
            const valor = document.getElementById("qtdProduto").value;
            const descricao = document.getElementById("descricaoProduto").value;
    
            // Cria o objeto de dados a ser enviado na requisição
            const dadosProduto = {
                nomeProduto: nomeProduto,
                valor: valor,
                descricao: descricao
            };
    
            fetch(url, {
                method: 'POST',
                headers: {
                    'Accept': '*/*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dadosProduto)
            })
            .then(response => {
                if (response.ok) {
                    return response.json(); 
                } else {
                    console.error('Erro ao cadastrar produto');
                    toast("error", "Erro ao cadastrar produto");
                }
            })
            .then(data => {
                console.log('produto cadastrado com sucesso:', data);
                toast("success", "produto cadastrado com sucesso!");
                window.location.href = "../Listas/listagemProduto.html"; // Redireciona para a tela de listagemProduto após o cadastro
            })
            .catch(error => {
                console.error('Erro:', error);
                toast("error", "Ocorreu um erro ao tentar cadastrar o produto.");
            });
        }

        // /===== TOAST  =====/
function toast(tipoToast, mensagem) {
  switch (tipoToast) {
    case "success":

      Toastify({
        text: mensagem,
        className: "success",
        style: {
          background: "linear-gradient(to right,  #711e92, #5b087c)",
        }
      }).showToast();

      break;
    case "error":

      Toastify({
        text: mensagem,
        className: "error",
        style: {
          background: "linear-gradient(to right, #ff0000, #b30000, #800000)"
        }
      }).showToast();

      break;
  }

}

    </script>
    
</html>